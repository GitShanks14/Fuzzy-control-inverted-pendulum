<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head>

		<script async="" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/analytics.js"></script><script type="text/javascript" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/jquery.js"></script>

		<link rel="stylesheet" type="text/css" href="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/style.css"><script>console.log('example: InvertedPendulum	section: SystemModeling	aux: 	q: ');</script>
		<script type="text/javascript">

			var example = "InvertedPendulum";
			var section = "SystemModeling";
			var aux = "";
			var effects = Boolean();
			var tips = Boolean();
			$.fx.off = !effects;

			$(document).keydown(function(e){
				if (!$("#search_field").is(":focus")){
					if (e.keyCode == 39) {
						window.location = "?example=InvertedPendulum&section=SystemAnalysis";
					}
					if (e.keyCode == 37) {
						window.history.back()
					}
				}
			});

		</script>

		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<meta http-equiv="PRAGMA" content="NO-CACHE">

		<title>Control Tutorials for MATLAB and Simulink - Inverted Pendulum: System Modeling</title>

	</head>

	<body data-new-gr-c-s-check-loaded="8.896.0" data-gr-ext-installed="">
		<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44773621-2', 'auto');
  ga('send', 'pageview');

</script>
		<div id="container" style="opacity: 1;">

			<form id="search_form"><input id="search_field" type="text" name="q" placeholder="Search Control Tutorials"></form>
			<form class="option_form" method="post" onclick="submit()"><div>Effects</div><input type="hidden" name="effects" value="0"><input type="checkbox" name="effects" value="1"></form>
			<form class="option_form" method="post" onclick="submit()"><div>Tips</div><input type="hidden" name="tips" value="0"><input type="checkbox" name="tips" value="1"></form>

			<div style="clear:both"></div>

			<div id="header" style="height: 27px;">

				<div id="logo_container" style="padding-top: 5.5px;">
					<a href="http://www.umich.edu/" title="University of Michigan"><img class="logo" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/UMich.png"></a><a href="http://www.cmu.edu/" title="Carnegie Mellon University"><img class="logo" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/CMU.png"></a><a href="http://www.udmercy.edu/" title="University of Detroit Mercy"><img class="logo" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/UDMercy_new.png"></a>
				</div>

				<div id="menu_container">

					<ul class="menu">
						<li class="heading" id="Tips"><a href="https://ctms.engin.umich.edu/CTMS/index.php?aux=Extras_Tips">TIPS</a></li>
						<div class="collapse"><div class="expand">
						</div></div>
					</ul>

					<ul class="menu">
						<li class="heading" id="About"><a>ABOUT</a></li>
						<div class="collapse"><div class="expand">
							<li class="item" id="About_Tutorials"><a href="https://ctms.engin.umich.edu/CTMS/index.php?aux=About_Tutorials">Tutorials</a></li>
							<li class="item" id="About_Contact"><a href="mailto:ControlTutorialsMatlabSimulink@gmail.com">Contact</a></li>
						</div></div>
					</ul>

					<ul class="menu">
						<li class="heading" id="Basics"><a>BASICS</a></li>
						<div class="collapse"><div class="expand">
							<li class="item" id="Basics_Matlab"><a href="https://ctms.engin.umich.edu/CTMS/index.php?aux=Basics_Matlab">MATLAB</a></li>
							<li class="item" id="Basics_Simulink"><a href="https://ctms.engin.umich.edu/CTMS/index.php?aux=Basics_Simulink">Simulink</a></li>
						</div></div>
					</ul>

					<ul class="menu">
						<li class="heading" id="Index"><a>HARDWARE</a></li>
						<div class="collapse"><div class="expand">
							<li class="item" id="Index_Activities"><a href="https://ctms.engin.umich.edu/CTMS/index.php?aux=Index_Activities">Overview</a></li>
							<li class="item" id="Activities_RCcircuitA"><a href="https://ctms.engin.umich.edu/CTMS/index.php?aux=Activities_RCcircuitA">RC circuit</a></li>
							<li class="item" id="Activities_LRCcircuitA"><a href="https://ctms.engin.umich.edu/CTMS/index.php?aux=Activities_LRCcircuitA">LRC circuit</a></li>
							<li class="item" id="Activities_Pendulum"><a href="https://ctms.engin.umich.edu/CTMS/index.php?aux=Activities_Pendulum">Pendulum</a></li>
							<li class="item" id="Activities_Lightbulb"><a href="https://ctms.engin.umich.edu/CTMS/index.php?aux=Activities_Lightbulb">Lightbulb</a></li>
							<li class="item" id="Activities_BoostcircuitA"><a href="https://ctms.engin.umich.edu/CTMS/index.php?aux=Activities_BoostcircuitA">BoostConverter</a></li>
							<li class="item" id="Activities_DCmotorA"><a href="https://ctms.engin.umich.edu/CTMS/index.php?aux=Activities_DCmotorA">DC motor</a></li>
						</div></div>
					</ul>

					<ul class="menu">
						<li class="heading" id="Index"><a>INDEX</a></li>
						<div class="collapse"><div class="expand">
							<li class="item" id="Index_Tutorials"><a href="https://ctms.engin.umich.edu/CTMS/index.php?aux=Index_Tutorials">Tutorials</a></li>
							<li class="item" id="Index_Commands"><a href="https://ctms.engin.umich.edu/CTMS/index.php?aux=Index_Commands">Commands</a></li>
							<li class="item" id="Index_Animations"><a href="https://ctms.engin.umich.edu/CTMS/index.php?aux=Index_Animations">Animations</a></li>
							<li class="item" id="Index_Extras"><a href="https://ctms.engin.umich.edu/CTMS/index.php?aux=Index_Extras">Extras</a></li>
						</div></div>
					</ul>

					<ul class="menu">
						<li class="heading" id="Next"><a href="https://ctms.engin.umich.edu/CTMS/index.php?example=InvertedPendulum&amp;section=SystemAnalysis">NEXT&nbsp;â–º</a></li>
						<div class="collapse"><div class="expand">
						</div></div>
					</ul>

				</div>

			</div>

			<div id="body_container">

				<div id="gradient_container"></div>

				<div id="top">

					<a href="https://ctms.engin.umich.edu/CTMS/index.php?aux=Home"><img id="CTMS_logo" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/CTMS_logo.png"></a>

					<ul class="example" style="overflow-y: hidden;">

						<li class="item" id="Introduction"><a href="https://ctms.engin.umich.edu/CTMS/index.php?example=Introduction&amp;section=SystemModeling"><img class="icon" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/Introduction_Icon.png"><div class="tab">INTRODUCTION</div></a></li>
						<li class="item" id="CruiseControl"><a href="https://ctms.engin.umich.edu/CTMS/index.php?example=CruiseControl&amp;section=SystemModeling"><img class="icon" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/CruiseControl_Icon.png"><div class="tab">CRUISE&nbsp;CONTROL</div></a></li>
						<li class="item" id="MotorSpeed"><a href="https://ctms.engin.umich.edu/CTMS/index.php?example=MotorSpeed&amp;section=SystemModeling"><img class="icon" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/MotorSpeed_Icon.png"><div class="tab">MOTOR&nbsp;SPEED</div></a></li>
						<li class="item" id="MotorPosition"><a href="https://ctms.engin.umich.edu/CTMS/index.php?example=MotorPosition&amp;section=SystemModeling"><img class="icon" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/MotorPosition_Icon.png"><div class="tab" style="background: rgba(0, 0, 0, 0) -webkit-linear-gradient(rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0.25) 100%) repeat scroll 0% 0%; color: rgb(255, 255, 255);">MOTOR&nbsp;POSITION</div></a></li>
						<li class="item" id="Suspension"><a href="https://ctms.engin.umich.edu/CTMS/index.php?example=Suspension&amp;section=SystemModeling"><img class="icon" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/Suspension_Icon.png"><div class="tab">SUSPENSION</div></a></li>
						<li class="item" id="InvertedPendulum"><a href="https://ctms.engin.umich.edu/CTMS/index.php?example=InvertedPendulum&amp;section=SystemModeling"><img class="icon" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_Icon_Selected.png"><div class="tab" style="background: rgba(0, 0, 0, 0) linear-gradient(rgba(255, 255, 255, 0) 0%, rgba(255, 255, 255, 0.25) 100%) repeat scroll 0% 0%;">INVERTED&nbsp;PENDULUM</div></a></li>
						<li class="item" id="AircraftPitch"><a href="https://ctms.engin.umich.edu/CTMS/index.php?example=AircraftPitch&amp;section=SystemModeling"><img class="icon" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/AircraftPitch_Icon.png"><div class="tab">AIRCRAFT&nbsp;PITCH</div></a></li>
						<li class="item" id="BallBeam"><a href="https://ctms.engin.umich.edu/CTMS/index.php?example=BallBeam&amp;section=SystemModeling"><img class="icon" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/BallBeam_Icon.png"><div class="tab">BALL&nbsp;&amp;&nbsp;BEAM</div></a></li>

					</ul>

				</div>

				<div id="content_container">
					<div class="content">
   <div class="content_fx" style="opacity: 1;">
   <div class="introduction">
      <h1>Inverted Pendulum: System Modeling</h1>
      <!--introduction-->
      <p>Key MATLAB commands used in this tutorial are: <a href="http://www.mathworks.com/help/toolbox/control/ref/tf.html"><tt>tf</tt></a> , <a href="http://www.mathworks.com/help/toolbox/control/ref/ss.html"><tt>ss</tt></a> , <a href="http://www.mathworks.com/help/toolbox/control/ref/set.html"><tt>set</tt></a></p>
            </div>
	  <div class="related_links">
      <h3>Related Tutorial Links</h3>
      <ul>
        <li><a href="https://ctms.engin.umich.edu/CTMS/index.php?example=Introduction&amp;section=SystemModeling">Intro to Modeling</a></li>
		<li><a href="https://ctms.engin.umich.edu/CTMS/index.php?aux=Activities_Pendulum">Pendulum Activity</a></li>
      </ul>
	  <h3>Related External Links</h3>
      <ul>
		<li><a href="https://www.mathworks.com/academia/student_center/tutorials/source/controls/System_Representation/player.html">System Rep in MATLAB Video</a></li>
		<li><a href="https://www.youtube.com/watch?v=vwso-xHLNGc">Modeling Intro Video</a></li>
      </ul>
    </div>
    <div class="clearboth"></div>
	  <!--/introduction-->
      <h2>Contents</h2>
      <div>
         <ul>
            <li><a href="#1">Problem setup and design requirements</a></li>
            <li><a href="#3">Force analysis and system equations</a></li>
            <li><a href="#7">MATLAB representation</a></li>
         </ul>
      </div>
      <h2>Problem setup and design requirements<a name="1"></a></h2>
      <p>The system in this example consists of an inverted pendulum 
mounted to a motorized cart. The inverted pendulum system is an
         example commonly found in control system textbooks and research
 literature. Its popularity derives in part from the fact that
         it is unstable without control, that is, the pendulum will 
simply fall over if the cart isn't moved to balance it. Additionally,
         the dynamics of the system are nonlinear. The objective of the 
control system is to balance the inverted pendulum by applying
         a force to the cart that the pendulum is attached to. A 
real-world example that relates directly to this inverted pendulum
         system is the attitude control of a booster rocket at takeoff.
      </p>
      <p>In this case we will consider a two-dimensional problem where the pendulum is constrained to move in the vertical plane shown
         in the figure below. For this system, the control input is the force <img class="inline_eqn" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_SystemModeling_eq08597826192214703288.png" alt="$F$"> that moves the cart horizontally and the outputs are the angular position of the pendulum <img class="inline_eqn" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_SystemModeling_eq08288499342375314727.png" alt="$\theta$"> and the horizontal position of the cart <img class="inline_eqn" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_SystemModeling_eq12428413953531653171.png" alt="$x$">.
      </p>
      <p><img class="figure" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/pendulum.png" alt="" vspace="5" hspace="5"> </p>
      <p>For this example, let's assume the following quantities:</p><pre>(M)       mass of the cart                         0.5 kg</pre><pre>(m)       mass of the pendulum                     0.2 kg</pre><pre>(b)       coefficient of friction for cart         0.1 N/m/sec</pre><pre>(l)       length to pendulum center of mass        0.3 m</pre><pre>(I)       mass moment of inertia of the pendulum   0.006 kg.m^2</pre><pre>(F)       force applied to the cart</pre><pre>(x)       cart position coordinate</pre><pre>(theta)   pendulum angle from vertical (down)</pre><p>For
 the PID, root locus, and frequency response sections of this problem, 
we will be interested only in the control of the
         pendulum's position. This is because the techniques used in 
these sections are best-suited for single-input, single-output
         (SISO) systems. Therefore, none of the design criteria deal 
with the cart's position. We will, however, investigate the controller's
         effect on the cart's position after the controller has been 
designed. For these sections, we will design a controller to restore
         the pendulum to a vertically upward position after it has 
experienced an impulsive "bump" to the cart. Specifically, the design
         criteria are that the pendulum return to its upright position 
within 5 seconds and that the pendulum never move more than
         0.05 radians away from vertical after being disturbed by an 
impulse of magnitude 1 Nsec. The pendulum will initially begin
         in the vertically upward equilibrium, <img class="inline_eqn" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_SystemModeling_eq08288499342375314727.png" alt="$\theta$"> = <img class="inline_eqn" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_SystemModeling_eq12719111378361454579.png" alt="$\pi$">.
      </p>
      <p>In summary, the design requirements for this system are:</p>
      <div>
         <ul>
            <li>Settling time for <img class="inline_eqn" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_SystemModeling_eq08288499342375314727.png" alt="$\theta$"> of less than 5 seconds
            </li>
            <li>Pendulum angle <img class="inline_eqn" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_SystemModeling_eq08288499342375314727.png" alt="$\theta$"> never more than 0.05 radians from the vertical
            </li>
         </ul>
      </div>
      <p>Employing state-space design techniques, we are more readily 
able to address a multi-output system. In our case, the inverted
         pendulum system is single-input, multi-output (SIMO). 
Therefore, for the state-space section of the Inverted Pendulum example,
         we will attempt to control both the pendulum's angle and the 
cart's position. To make the design more challenging in this
         section, we will command a 0.2-meter step in the cart's desired
 position. Under these conditions, it is desired that the cart
         achieve its commanded position within 5 seconds and have a rise
 time under 0.5 seconds. It is also desired that the pendulum
         settle to its vertical position in under 5 seconds, and 
further, that the pendulum angle not travel more than 20 degrees (0.35
         radians) away from the vertically upward position.
      </p>
      <p>In summary, the design requirements for the inverted pendulum state-space example are:</p>
      <div>
         <ul>
            <li>Settling time for <img class="inline_eqn" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_SystemModeling_eq12428413953531653171.png" alt="$x$"> and <img class="inline_eqn" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_SystemModeling_eq08288499342375314727.png" alt="$\theta$"> of less than 5 seconds
            </li>
            <li>Rise time for <img class="inline_eqn" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_SystemModeling_eq12428413953531653171.png" alt="$x$"> of less than 0.5 seconds
            </li>
            <li>Pendulum angle <img class="inline_eqn" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_SystemModeling_eq08288499342375314727.png" alt="$\theta$"> never more than 20 degrees (0.35 radians) from the vertical
            </li>
            <li>Steady-state error of less than 2% for <img class="inline_eqn" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_SystemModeling_eq12428413953531653171.png" alt="$x$"> and <img class="inline_eqn" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_SystemModeling_eq08288499342375314727.png" alt="$\theta$"></li>
         </ul>
      </div>
      <h2>Force analysis and system equations<a name="3"></a></h2>
      <p>Below are the free-body diagrams of the two elements of the inverted pendulum system.</p>
      <p><img class="figure" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/pendulum2.png" alt="" vspace="5" hspace="5"> </p>
      <p>Summing the forces in the free-body diagram of the cart in the horizontal direction, you get the following equation of motion.</p>
      <p><span class="eqn_num">(1)</span><img class="display_eqn" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_SystemModeling_eq04969844015732198169.png" alt="$$ M\ddot{x}+b\dot{x}+N = F $$"></p>
      <p>Note that you can also sum the forces in the vertical direction for the cart, but no useful information would be gained.</p>
      <p>Summing the forces in the free-body diagram of the pendulum in the horizontal direction, you get the following expression
         for the reaction force <img class="inline_eqn" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_SystemModeling_eq03672095713503266041.png" alt="$N$">.
      </p>
      <p><span class="eqn_num">(2)</span><img class="display_eqn" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_SystemModeling_eq04062157606042495978.png" alt="$$ N= m\ddot{x}+ml\ddot{\theta}\cos\theta-ml\dot{\theta}^2\sin\theta $$"></p>
      <p>If you substitute this equation into the first equation, you get one of the two governing equations for this system.</p>
      <p><span class="eqn_num">(3)</span><img class="display_eqn" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_SystemModeling_eq16820723935915799356.png" alt="$$(M+m)\ddot{x}+b\dot{x}+ml\ddot{\theta}\cos\theta-ml\dot{\theta}^2\sin\theta=F $$"></p>
      <p>To get the second equation of motion for this system, sum the forces perpendicular to the pendulum. Solving the system along
         this axis greatly simplifies the mathematics. You should get the following equation.
      </p>
      <p><span class="eqn_num">(4)</span><img class="display_eqn" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_SystemModeling_eq07455313365310646524.png" alt="$$P\sin\theta+N\cos\theta-mg\sin\theta=ml\ddot{\theta}+m\ddot{x}\cos\theta$$"></p>
      <p>To get rid of the <img class="inline_eqn" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_SystemModeling_eq02661806082982697695.png" alt="$P$"> and <img class="inline_eqn" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_SystemModeling_eq03672095713503266041.png" alt="$N$"> terms in the equation above, sum the moments about the centroid of the pendulum to get the following equation.
      </p>
      <p><span class="eqn_num">(5)</span><img class="display_eqn" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_SystemModeling_eq10686941019184014575.png" alt="$$-Pl\sin\theta-Nl\cos\theta=I\ddot{\theta}$$"></p>
      <p>Combining these last two expressions, you get the second governing equation.</p>
      <p><span class="eqn_num">(6)</span><img class="display_eqn" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_SystemModeling_eq06339976115683057145.png" alt="$$(I+ml^2)\ddot{\theta}+mgl\sin\theta=-ml\ddot{x}\cos\theta $$"></p>
      <p>Since the analysis and control design techniques we will be 
employing in this example apply only to linear systems, this set
         of equations needs to be linearized. Specifically, we will 
linearize the equations about the vertically upward equillibrium
         position, <img class="inline_eqn" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_SystemModeling_eq08288499342375314727.png" alt="$\theta$"> = <img class="inline_eqn" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_SystemModeling_eq12719111378361454579.png" alt="$\pi$">,
 and will assume that the system stays within a small neighborhood of 
this equillbrium. This assumption should be reasonably
         valid since under control we desire that the pendulum not 
deviate more than 20 degrees from the vertically upward position.
         Let <img class="inline_eqn" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_SystemModeling_eq06401276552089372917.png" alt="$\phi$"> represent the deviation of the pedulum's position from equilibrium, that is, <img class="inline_eqn" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_SystemModeling_eq08288499342375314727.png" alt="$\theta$"> = <img class="inline_eqn" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_SystemModeling_eq12719111378361454579.png" alt="$\pi$"> + <img class="inline_eqn" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_SystemModeling_eq06401276552089372917.png" alt="$\phi$">. Again presuming a small deviation (<img class="inline_eqn" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_SystemModeling_eq06401276552089372917.png" alt="$\phi$">) from equilibrium, we can use the following small angle approximations of the nonlinear functions in our system equations:
      </p>
      <p><span class="eqn_num">(7)</span><img class="display_eqn" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_SystemModeling_eq06720336858072493337.png" alt="$$ \cos \theta = \cos(\pi + \phi) \approx -1 $$"></p>
      <p><span class="eqn_num">(8)</span><img class="display_eqn" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_SystemModeling_eq11743783774505720891.png" alt="$$ \sin \theta = \sin(\pi + \phi) \approx -\phi $$"></p>
      <p><span class="eqn_num">(9)</span><img class="display_eqn" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_SystemModeling_eq10183162542552796906.png" alt="$$ \dot{\theta}^2 =  \dot{\phi}^2 \approx 0 $$"></p>
      <p>After substiting the above approximations into our nonlinear governing equations, we arrive at the two linearized equations
         of motion. Note <img class="inline_eqn" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_SystemModeling_eq11776305044305525613.png" alt="$u$"> has been substituted for the input <img class="inline_eqn" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_SystemModeling_eq08597826192214703288.png" alt="$F$">.
      </p>
      <p><span class="eqn_num">(10)</span><img class="display_eqn" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_SystemModeling_eq13562382131538731554.png" alt="$$ (I+ml^2)\ddot{\phi}-mgl\phi=ml\ddot{x} $$"></p>
      <p><span class="eqn_num">(11)</span><img class="display_eqn" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_SystemModeling_eq16664123656188086649.png" alt="$$ (M+m)\ddot{x}+b\dot{x}-ml\ddot{\phi}=u $$"></p>
      <p><b>1. Transfer Function</b></p>
      <p>To obtain the transfer functions of the linearized system equations, we must first take the Laplace transform of the system
         equations assuming zero initial conditions. The resulting Laplace transforms are shown below.
      </p>
      <p><span class="eqn_num">(12)</span><img class="display_eqn" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_SystemModeling_eq08059026715589332808.png" alt="$$(I+ml^2)\Phi(s)s^2-mgl\Phi(s)=mlX(s)s^2$$"></p>
      <p><span class="eqn_num">(13)</span><img class="display_eqn" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_SystemModeling_eq18273867574268846682.png" alt="$$(M+m)X(s)s^2+bX(s)s-ml\Phi(s)s^2=U(s)$$"></p>
      <p>Recall that a transfer function represents the relationship between a single input and a single output at a time. To find
         our first transfer function for the output <img class="inline_eqn" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_SystemModeling_eq14111833975206011288.png" alt="$\Phi(s)$"> and an input of <img class="inline_eqn" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_SystemModeling_eq04928925248725872882.png" alt="$U(s)$"> we need to eliminate <img class="inline_eqn" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_SystemModeling_eq07689959845095838553.png" alt="$X(s)$"> from the above equations. Solve the first equation for <img class="inline_eqn" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_SystemModeling_eq07689959845095838553.png" alt="$X(s)$">.
      </p>
      <p><span class="eqn_num">(14)</span><img class="display_eqn" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_SystemModeling_eq16666459677431253110.png" alt="$$ X(s)=\left[{\frac{I+ml^2}{ml}-\frac{g}{s^2}}\right]\Phi(s) $$"></p>
      <p>Then substitute the above into the second equation.</p>
      <p><span class="eqn_num">(15)</span><img class="display_eqn" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_SystemModeling_eq15508974487780254044.png" alt="$$(M+m)\left[\frac{I+ml^2}{ml}-\frac{g}{s^2}\right]\Phi(s)s^2+b\left[\frac{I+ml^2}{ml}-\frac{g}{s^2}\right]\Phi(s)s-ml\Phi(s)s^2=U(s)$$"></p>
      <p>Rearranging, the transfer function is then the following</p>
      <p><span class="eqn_num">(16)</span><img class="display_eqn" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_SystemModeling_eq18328930626635665187.png" alt="$$\frac{\Phi(s)}{U(s)}=\frac{\frac{ml}{q}s^2}{s^4+\frac{b(I+ml^2)}{q}s^3-\frac{(M+m)mgl}{q}s^2-\frac{bmgl}{q}s}$$"></p>
      <p>where,</p>
      <p><span class="eqn_num">(17)</span><img class="display_eqn" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_SystemModeling_eq13265040714817152519.png" alt="$$q=[(M+m)(I+ml^2)-(ml)^2]$$"></p>
      <p>From the transfer function above it can be seen that there is both a pole and a zero at the origin. These can be canceled
         and the transfer function becomes the following.
      </p>
      <p><span class="eqn_num">(18)</span><img class="display_eqn" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_SystemModeling_eq14490034572073561881.png" alt="$$P_{pend}(s) = \frac{\Phi(s)}{U(s)}=\frac{\frac{ml}{q}s}{s^3+\frac{b(I+ml^2)}{q}s^2-\frac{(M+m)mgl}{q}s-\frac{bmgl}{q}} \qquad [ \frac{rad}{N}]$$"></p>
      <p>Second, the transfer function with the cart position <img class="inline_eqn" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_SystemModeling_eq07689959845095838553.png" alt="$X(s)$"> as the output can be derived in a similar manner to arrive at the following.
      </p>
      <p><span class="eqn_num">(19)</span><img class="display_eqn" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_SystemModeling_eq15167269722217001217.png" alt="$$P_{cart}(s) = \frac{X(s)}{U(s)} = \frac{ \frac{ (I+ml^2)s^2 - gml } {q}
}{s^4+\frac{b(I+ml^2)}{q}s^3-\frac{(M+m)mgl}{q}s^2-\frac{bmgl}{q}s}
\qquad [ \frac{m}{N}] $$"></p>
      <p><b>2. State-Space</b></p>
      <p>The linearized equations of motion from above can also be 
represented in state-space form if they are rearranged into a series
         of first order differential equations. Since the equations are 
linear, they can then be put into the standard matrix form
         shown below.
      </p>
      <p><span class="eqn_num">(20)</span><img class="display_eqn" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_SystemModeling_eq14127640478467589374.png" alt="$$
\left[{\begin{array}{c}
  \dot{x}\\ \ddot{x}\\ \dot{\phi}\\ \ddot{\phi}
\end{array}}\right] =
\left[{\begin{array}{cccc}
  0&amp;1&amp;0&amp;0\\
  0&amp;\frac{-(I+ml^2)b}{I(M+m)+Mml^2}&amp;\frac{m^2gl^2}{I(M+m)+Mml^2}&amp;0\\
  0&amp;0&amp;0&amp;1\\
  0&amp;\frac{-mlb}{I(M+m)+Mml^2}&amp;\frac{mgl(M+m)}{I(M+m)+Mml^2}&amp;0
\end{array}}\right]
\left[{\begin{array}{c}
  x\\ \dot{x}\\ \phi\\ \dot{\phi}
\end{array}}\right]+
\left[{\begin{array}{c}0\\
  \frac{I+ml^2}{I(M+m)+Mml^2}\\
  0 \\
  \frac{ml}{I(M+m)+Mml^2}
\end{array}}\right]u$$"></p>
      <p><span class="eqn_num">(21)</span><img class="display_eqn" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_SystemModeling_eq13622041353118727580.png" alt="$${\bf y} =
\left[{\begin{array}{cccc}
  1&amp;0&amp;0&amp;0\\0&amp;0&amp;1&amp;0
\end{array}}\right]
\left[{\begin{array}{c}
  x\\ \dot{x}\\ \phi\\ \dot{\phi}
\end{array}}\right]+
\left[{\begin{array}{c}
  0\\0
\end{array}}\right]u$$"></p>
      <p>The <img class="inline_eqn" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_SystemModeling_eq03986222445007418011.png" alt="$C$"> matrix has 2 rows because both the cart's position and the pendulum's position are part of the output. Specifically, the
         cart's position is the first element of the output <img class="inline_eqn" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_SystemModeling_eq01759449390978539805.png" alt="$\mathbf{y}$"> and the pendulum's deviation from its equilibrium position is the second element of <img class="inline_eqn" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/InvertedPendulum_SystemModeling_eq01759449390978539805.png" alt="$\mathbf{y}$">.
      </p>
      <h2>MATLAB representation<a name="7"></a></h2>
      <p><b>1. Transfer Function</b></p>
      <p>We can represent the transfer functions derived above for the 
inverted pendulum system within MATLAB employing the following
         commands. Note that you can give names to the outputs (and 
inputs) to differentiate between the cart's position and the pendulum's
         position. Running this code in the command window produces the 
output shown below.
      </p><pre class="codeinput">M = 0.5;
m = 0.2;
b = 0.1;
I = 0.006;
g = 9.8;
l = 0.3;
q = (M+m)*(I+m*l^2)-(m*l)^2;
s = tf(<span class="string">'s'</span>);

P_cart = (((I+m*l^2)/q)*s^2 - (m*g*l/q))/(s^4 + (b*(I + m*l^2))*s^3/q - ((M + m)*m*g*l)*s^2/q - b*m*g*l*s/q);

P_pend = (m*l*s/q)/(s^3 + (b*(I + m*l^2))*s^2/q - ((M + m)*m*g*l)*s/q - b*m*g*l/q);

sys_tf = [P_cart ; P_pend];

inputs = {<span class="string">'u'</span>};
outputs = {<span class="string">'x'</span>; <span class="string">'phi'</span>};

set(sys_tf,<span class="string">'InputName'</span>,inputs)
set(sys_tf,<span class="string">'OutputName'</span>,outputs)

sys_tf
</pre><pre class="codeoutput">sys_tf =
 
  From input "u" to output...
                       4.182e-06 s^2 - 0.0001025
   x:  ---------------------------------------------------------
       2.3e-06 s^4 + 4.182e-07 s^3 - 7.172e-05 s^2 - 1.025e-05 s
 
                              1.045e-05 s
   phi:  -----------------------------------------------------
         2.3e-06 s^3 + 4.182e-07 s^2 - 7.172e-05 s - 1.025e-05
 
Continuous-time transfer function.

</pre><p><b>2. State-Space</b></p>
      <p>We can also represent the system using the state-space 
equations. The following additional MATLAB commands create a state-space
         model of the inverted pendulum and produce the output shown 
below when run in the MATLAB command window. Again note that the
         names of the inputs, outputs, and states can be specified to 
make the model easier to understand.
      </p><pre class="codeinput">M = .5;
m = 0.2;
b = 0.1;
I = 0.006;
g = 9.8;
l = 0.3;

p = I*(M+m)+M*m*l^2; <span class="comment">%denominator for the A and B matrices</span>

A = [0      1              0           0;
     0 -(I+m*l^2)*b/p  (m^2*g*l^2)/p   0;
     0      0              0           1;
     0 -(m*l*b)/p       m*g*l*(M+m)/p  0];
B = [     0;
     (I+m*l^2)/p;
          0;
        m*l/p];
C = [1 0 0 0;
     0 0 1 0];
D = [0;
     0];

states = {<span class="string">'x'</span> <span class="string">'x_dot'</span> <span class="string">'phi'</span> <span class="string">'phi_dot'</span>};
inputs = {<span class="string">'u'</span>};
outputs = {<span class="string">'x'</span>; <span class="string">'phi'</span>};

sys_ss = ss(A,B,C,D,<span class="string">'statename'</span>,states,<span class="string">'inputname'</span>,inputs,<span class="string">'outputname'</span>,outputs)
</pre><pre class="codeoutput">sys_ss =
 
  A = 
                  x    x_dot      phi  phi_dot
   x              0        1        0        0
   x_dot          0  -0.1818    2.673        0
   phi            0        0        0        1
   phi_dot        0  -0.4545    31.18        0
 
  B = 
                u
   x            0
   x_dot    1.818
   phi          0
   phi_dot  4.545
 
  C = 
              x    x_dot      phi  phi_dot
   x          1        0        0        0
   phi        0        0        1        0
 
  D = 
        u
   x    0
   phi  0
 
Continuous-time state-space model.

</pre><p>The above state-space model can also be converted into transfer function form employing the <tt>tf</tt> command as shown below. Conversely, the transfer function model can be converted into state-space form using the <tt>ss</tt> command.
      </p><pre class="codeinput">sys_tf = tf(sys_ss)
</pre><pre class="codeoutput">sys_tf =
 
  From input "u" to output...
          1.818 s^2 + 1.615e-15 s - 44.55
   x:  --------------------------------------
       s^4 + 0.1818 s^3 - 31.18 s^2 - 4.455 s
 
                4.545 s - 1.277e-16
   phi:  ----------------------------------
         s^3 + 0.1818 s^2 - 31.18 s - 4.455
 
Continuous-time transfer function.

</pre><p>Examining the above, note the existance of some terms with very
 small coefficients. These terms should actually be zero and
         show up due to numerical round-off errors that accumulate in 
the conversion algorithms that MATLAB employs. If you set these
         coefficients to zero, then the above transfer function models 
will match those generated earlier in the <b>Transfer Function</b> section of the example.
      </p>
      <p class="footer"><br>
         Published with MATLABÂ® 9.2<br></p>
   </div>
</div>
<!--
##### SOURCE BEGIN #####
%% Inverted Pendulum: System Modeling
%
% Key MATLAB commands used in this tutorial are:
% <http://www.mathworks.com/help/toolbox/control/ref/tf.html |tf|> , 
% <http://www.mathworks.com/help/toolbox/control/ref/ss.html |ss|> ,
% <http://www.mathworks.com/help/toolbox/control/ref/set.html |set|> 
%
%% Problem setup and design requirements
% The system in this example consists of an inverted pendulum mounted to a
% motorized cart. The inverted pendulum system is an example commonly
% found in control system textbooks and research literature. Its
% popularity derives in part from the fact that it is unstable without
% control, that is, the pendulum will simply fall over if the cart isn't
% moved to balance it. Additionally, the dynamics of the system are
% nonlinear. The objective of the control system is to balance the inverted
% pendulum by applying a force to the cart that the pendulum is attached
% to. A real-world example that relates directly to this inverted pendulum
% system is the attitude control of a booster rocket at takeoff. 
%
% In this case we will consider a two-dimensional problem where the
% pendulum is constrained to move in the vertical plane shown in the figure
% below. For this system, the control input is the force $F$ that moves the
% cart horizontally and the outputs are the angular position of the
% pendulum $\theta$ and the horizontal position of the cart $x$.
%
% <<Content/InvertedPendulum/System/Modeling/figures/pendulum.png>>
% 
%%
% For this example, let's assume the following quantities:
% 
%  (M)       mass of the cart                         0.5 kg
% 
%  (m)       mass of the pendulum                     0.2 kg
% 
%  (b)       coefficient of friction for cart         0.1 N/m/sec
% 
%  (l)       length to pendulum center of mass        0.3 m
% 
%  (I)       mass moment of inertia of the pendulum   0.006 kg.m^2
% 
%  (F)       force applied to the cart	
% 
%  (x)       cart position coordinate	
% 
%  (theta)   pendulum angle from vertical (down)	
%
% For the PID, root locus, and frequency response sections of this problem,
% we will be interested only in the control of the pendulum's position. This
% is because the techniques used in these sections are best-suited for
% single-input, single-output (SISO) systems. Therefore, none of the design
% criteria deal with the cart's position. We will, however, investigate the
% controller's effect on the cart's position after the controller has been
% designed. For these sections, we will design a controller to restore the
% pendulum to a vertically upward position after it has experienced an
% impulsive "bump" to the cart. Specifically, the design criteria are that
% the pendulum return to its upright position within 5 seconds and that the
% pendulum never move more than 0.05 radians away from vertical after being
% disturbed by an impulse of magnitude 1 Nsec. The pendulum will
% initially begin in the vertically upward equilibrium, $\theta$ = $\pi$.  
% 
% In summary, the design requirements for this system are:
% 
% * Settling time for $\theta$ of less than 5 seconds
% * Pendulum angle $\theta$ never more than 0.05 radians from the vertical
% 
% Employing state-space design techniques, we are more readily able to address
% a multi-output system. In our case, the inverted pendulum system is
% single-input, multi-output (SIMO). Therefore, for the state-space section of the Inverted 
% Pendulum example, we will attempt to control both the pendulum's angle and
% the cart's position. To make the design more challenging in this section,
% we will command a 0.2-meter step in the cart's desired position. Under these conditions, it is desired
% that the cart achieve its commanded position within 5 seconds and have a
% rise time under 0.5 seconds. It is also desired that the pendulum
% settle to its vertical position in under 5 seconds, and further, that the
% pendulum angle not travel more than 20 degrees (0.35 radians) away from
% the vertically upward position.  
%
% In summary, the design requirements for the inverted pendulum state-space example are: 
% 
% * Settling time for $x$ and $\theta$ of less than 5 seconds
% * Rise time for $x$ of less than 0.5 seconds
% * Pendulum angle $\theta$ never more than 20 degrees (0.35 radians) from
% the vertical
% * Steady-state error of less than 2% for $x$ and $\theta$ 
%
%% Force analysis and system equations
% Below are the free-body diagrams of the two elements of the inverted pendulum system.
%
% <<Content/InvertedPendulum/System/Modeling/figures/pendulum2.png>>
% 
%%
% Summing the forces in the free-body diagram of the cart in the horizontal
% direction, you get the following equation of motion.
%
% $$ M\ddot{x}+b\dot{x}+N = F $$
% 
% Note that you can also sum the forces in the vertical direction for the cart, but no
% useful information would be gained. 
%
% Summing the forces in the free-body diagram of the pendulum in the
% horizontal direction, you get the following expression for the
% reaction force $N$.
% 
% $$ N= m\ddot{x}+ml\ddot{\theta}\cos\theta-ml\dot{\theta}^2\sin\theta $$
% 
% If you substitute this equation into the first equation, you get one of the
% two governing equations for this system.
% 
% $$(M+m)\ddot{x}+b\dot{x}+ml\ddot{\theta}\cos\theta-ml\dot{\theta}^2\sin\theta=F $$
%
% To get the second equation of motion for this system, sum the forces perpendicular to the
% pendulum. Solving the system along this axis greatly simplifies the
% mathematics. You should get the following equation.
%
% $$P\sin\theta+N\cos\theta-mg\sin\theta=ml\ddot{\theta}+m\ddot{x}\cos\theta$$
% 
% To get rid of the $P$ and $N$ terms in the equation above, sum the moments
% about the centroid of the pendulum to get the following equation.
% 
% $$-Pl\sin\theta-Nl\cos\theta=I\ddot{\theta}$$
% 
% Combining these last two expressions, you get the second governing equation.
% 
% $$(I+ml^2)\ddot{\theta}+mgl\sin\theta=-ml\ddot{x}\cos\theta $$
% 
% Since the analysis and control design techniques we will be employing
% in this example apply only to linear systems, this set of equations needs
% to be linearized. Specifically, we will linearize the equations about the
% vertically upward equillibrium position, $\theta$ = $\pi$, and will assume
% that the system stays within a small neighborhood of this equillbrium. This
% assumption should be reasonably valid since under control we desire that
% the pendulum not deviate more than 20 degrees from the vertically upward
% position. Let $\phi$ represent the deviation of the pedulum's position
% from equilibrium, that is, $\theta$ = $\pi$ + $\phi$. Again presuming a small
% deviation ($\phi$) from equilibrium, we can use the following small angle
% approximations of the nonlinear functions in our system equations:
%
% $$ \cos \theta = \cos(\pi + \phi) \approx -1 $$
%
% $$ \sin \theta = \sin(\pi + \phi) \approx -\phi $$
%
% $$ \dot{\theta}^2 =  \dot{\phi}^2 \approx 0 $$
% 
% After substiting the above approximations into our nonlinear governing
% equations, we arrive at the two linearized equations of motion. Note $u$
% has been substituted for the input $F$.
% 
% $$ (I+ml^2)\ddot{\phi}-mgl\phi=ml\ddot{x} $$
% 
% $$ (M+m)\ddot{x}+b\dot{x}-ml\ddot{\phi}=u $$
% 
%%
% *1. Transfer Function* 
% 
% To obtain the transfer functions of the linearized system equations, we
% must first take the Laplace transform of the system 
% equations assuming zero initial conditions. The resulting Laplace
% transforms are shown below.  
% 
% $$(I+ml^2)\Phi(s)s^2-mgl\Phi(s)=mlX(s)s^2$$
% 
% $$(M+m)X(s)s^2+bX(s)s-ml\Phi(s)s^2=U(s)$$
% 
% Recall that a transfer function represents the relationship between a
% single input and a single output at a time. To find our first transfer
% function for the output $\Phi(s)$ and an  
% input of $U(s)$ we need to eliminate $X(s)$ from the above equations.
% Solve the first equation for $X(s)$.
% 
% $$ X(s)=\left[{\frac{I+ml^2}{ml}-\frac{g}{s^2}}\right]\Phi(s) $$
% 
% Then substitute the above into the second equation.
% 
% $$(M+m)\left[\frac{I+ml^2}{ml}-\frac{g}{s^2}\right]\Phi(s)s^2+b\left[\frac{I+ml^2}{ml}-\frac{g}{s^2}\right]\Phi(s)s-ml\Phi(s)s^2=U(s)$$
% 
% Rearranging, the transfer function is then the following
% 
% $$\frac{\Phi(s)}{U(s)}=\frac{\frac{ml}{q}s^2}{s^4+\frac{b(I+ml^2)}{q}s^3-\frac{(M+m)mgl}{q}s^2-\frac{bmgl}{q}s}$$
% 
% where,
% 
% $$q=[(M+m)(I+ml^2)-(ml)^2]$$
% 
% From the transfer function above it can be seen that there is both a pole
% and a zero at the origin. These can be canceled and the transfer function
% becomes the following.
% 
% $$P_{pend}(s) = \frac{\Phi(s)}{U(s)}=\frac{\frac{ml}{q}s}{s^3+\frac{b(I+ml^2)}{q}s^2-\frac{(M+m)mgl}{q}s-\frac{bmgl}{q}} \qquad [ \frac{rad}{N}]$$
% 
% Second, the transfer function with the cart position $X(s)$ as the
% output can be derived in a similar manner to arrive at the following.
%
% $$P_{cart}(s) = \frac{X(s)}{U(s)} = \frac{ \frac{ (I+ml^2)s^2 - gml } {q}
% }{s^4+\frac{b(I+ml^2)}{q}s^3-\frac{(M+m)mgl}{q}s^2-\frac{bmgl}{q}s}
% \qquad [ \frac{m}{N}] $$
%
%%
% *2. State-Space*
% 
% The linearized equations of motion from above can also be represented in
% state-space form if they are rearranged into a series of first order
% differential equations. Since the equations are linear, they can then be
% put into the standard matrix form shown below.
%
% $$
% \left[{\begin{array}{c}
%   \dot{x}\\ \ddot{x}\\ \dot{\phi}\\ \ddot{\phi}
% \end{array}}\right] =
% \left[{\begin{array}{cccc}
%   0&1&0&0\\ 
%   0&\frac{-(I+ml^2)b}{I(M+m)+Mml^2}&\frac{m^2gl^2}{I(M+m)+Mml^2}&0\\ 
%   0&0&0&1\\ 
%   0&\frac{-mlb}{I(M+m)+Mml^2}&\frac{mgl(M+m)}{I(M+m)+Mml^2}&0
% \end{array}}\right]
% \left[{\begin{array}{c}
%   x\\ \dot{x}\\ \phi\\ \dot{\phi}
% \end{array}}\right]+
% \left[{\begin{array}{c}0\\ 
%   \frac{I+ml^2}{I(M+m)+Mml^2}\\ 
%   0 \\
%   \frac{ml}{I(M+m)+Mml^2}
% \end{array}}\right]u$$
% 
% $${\bf y} = 
% \left[{\begin{array}{cccc}
%   1&0&0&0\\0&0&1&0
% \end{array}}\right]
% \left[{\begin{array}{c}
%   x\\ \dot{x}\\ \phi\\ \dot{\phi}
% \end{array}}\right]+
% \left[{\begin{array}{c}
%   0\\0
% \end{array}}\right]u$$
%
% The $C$ matrix has 2 rows because both the cart's position and the
% pendulum's position are part of the output. Specifically, the cart's
% position is the first element of the output $\mathbf{y}$ and the pendulum's
% deviation from its equilibrium position is the second element of $\mathbf{y}$. 
% 
%% MATLAB representation
% 
% *1. Transfer Function*
% 
% We can represent the transfer functions derived above for the inverted
% pendulum system within MATLAB employing the following commands. Note that
% you can give names to the outputs (and inputs) to differentiate between
% the cart's position and the pendulum's position. Running 
% this code in the command window produces the output shown below. 

M = 0.5;
m = 0.2;
b = 0.1;
I = 0.006;
g = 9.8;
l = 0.3;
q = (M+m)*(I+m*l^2)-(m*l)^2;
s = tf('s');

P_cart = (((I+m*l^2)/q)*s^2 - (m*g*l/q))/(s^4 + (b*(I + m*l^2))*s^3/q - ((M + m)*m*g*l)*s^2/q - b*m*g*l*s/q);

P_pend = (m*l*s/q)/(s^3 + (b*(I + m*l^2))*s^2/q - ((M + m)*m*g*l)*s/q - b*m*g*l/q);

sys_tf = [P_cart ; P_pend];

inputs = {'u'};
outputs = {'x'; 'phi'};

set(sys_tf,'InputName',inputs)
set(sys_tf,'OutputName',outputs)

sys_tf

%%
% *2. State-Space*
% 
% We can also represent the system using the state-space equations. The
% following additional MATLAB commands create a state-space model of the
% inverted pendulum and produce the output shown below when run in the
% MATLAB command window. Again note that the names of the inputs, outputs,
% and states can be specified to make the model easier to understand.

M = .5;
m = 0.2;
b = 0.1;
I = 0.006;
g = 9.8;
l = 0.3;

p = I*(M+m)+M*m*l^2; %denominator for the A and B matrices

A = [0      1              0           0;
     0 -(I+m*l^2)*b/p  (m^2*g*l^2)/p   0;
     0      0              0           1;
     0 -(m*l*b)/p       m*g*l*(M+m)/p  0];
B = [     0; 
     (I+m*l^2)/p;
          0;
        m*l/p];
C = [1 0 0 0;
     0 0 1 0];
D = [0;
     0];
 
states = {'x' 'x_dot' 'phi' 'phi_dot'};
inputs = {'u'};
outputs = {'x'; 'phi'};

sys_ss = ss(A,B,C,D,'statename',states,'inputname',inputs,'outputname',outputs)

%%
% The above state-space model can also be converted into transfer function 
% form employing the |tf| command as shown below. Conversely, the transfer
% function model can be converted into state-space form using the |ss|
% command.

sys_tf = tf(sys_ss)

%%
% Examining the above, note the existance of some terms with very small
% coefficients. These terms should actually be zero and show up due to
% numerical round-off errors that accumulate in the conversion algorithms
% that MATLAB employs. If you set these coefficients to zero, then the
% above transfer function models will match those generated earlier in the
% *Transfer Function* section of the example.
##### SOURCE END #####
-->				</div>

				<div id="left">

					<ul class="section">
						<li class="heading" id="System">SYSTEM<img class="section_heading_arrow" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/section_heading_arrow.png" style="top: 9.5px;"></li>
						<li class="item" id="SystemModeling"><a href="https://ctms.engin.umich.edu/CTMS/index.php?example=InvertedPendulum&amp;section=SystemModeling" style="background: rgba(0, 0, 0, 0) linear-gradient(to right, rgba(255, 255, 255, 0) 0%, rgba(255, 255, 255, 0.2) 100%) repeat scroll 0% 0%;">MODELING<img class="section_arrow" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/section_arrow.png" style="top: 10px;"></a></li>
						<li class="item" id="SystemAnalysis"><a href="https://ctms.engin.umich.edu/CTMS/index.php?example=InvertedPendulum&amp;section=SystemAnalysis">ANALYSIS<img class="section_arrow" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/section_arrow.png" style="top: 10px;"></a></li>
					</ul>

					<div class="section_break"></div>

					<ul class="section">
						<li class="heading" id="Control">CONTROL<img class="section_heading_arrow" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/section_heading_arrow.png" style="top: 9.5px;"></li>
						<li class="item" id="ControlPID"><a href="https://ctms.engin.umich.edu/CTMS/index.php?example=InvertedPendulum&amp;section=ControlPID">PID<img class="section_arrow" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/section_arrow.png" style="top: 10px;"></a></li>
						<li class="item" id="ControlRootLocus"><a href="https://ctms.engin.umich.edu/CTMS/index.php?example=InvertedPendulum&amp;section=ControlRootLocus">ROOT&nbsp;LOCUS<img class="section_arrow" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/section_arrow.png" style="top: 10px;"></a></li>
						<li class="item" id="ControlFrequency"><a href="https://ctms.engin.umich.edu/CTMS/index.php?example=InvertedPendulum&amp;section=ControlFrequency">FREQUENCY<img class="section_arrow" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/section_arrow.png" style="top: 10px;"></a></li>
						<li class="item" id="ControlStateSpace"><a href="https://ctms.engin.umich.edu/CTMS/index.php?example=InvertedPendulum&amp;section=ControlStateSpace">STATE-SPACE<img class="section_arrow" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/section_arrow.png" style="top: 10px;"></a></li>
						<li class="item" id="ControlDigital"><a href="https://ctms.engin.umich.edu/CTMS/index.php?example=InvertedPendulum&amp;section=ControlDigital">DIGITAL<img class="section_arrow" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/section_arrow.png" style="top: 10px;"></a></li>
					</ul>

					<div class="section_break"></div>

					<ul class="section">
						<li class="heading" id="Simulink">SIMULINK<img class="section_heading_arrow" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/section_heading_arrow.png" style="top: 9.5px;"></li>
						<li class="item" id="SimulinkModeling"><a href="https://ctms.engin.umich.edu/CTMS/index.php?example=InvertedPendulum&amp;section=SimulinkModeling">MODELING<img class="section_arrow" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/section_arrow.png" style="top: 10px;"></a></li>
						<li class="item" id="SimulinkControl"><a href="https://ctms.engin.umich.edu/CTMS/index.php?example=InvertedPendulum&amp;section=SimulinkControl">CONTROL<img class="section_arrow" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/section_arrow.png" style="top: 10px;"></a></li>
						<li class="item" id="SimulinkSimscape"><a href="https://ctms.engin.umich.edu/CTMS/index.php?example=InvertedPendulum&amp;section=SimulinkSimscape">SIMSCAPE<img class="section_arrow" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/section_arrow.png" style="top: 10px;"></a></li>
					</ul>

				</div>

				<div style="clear:both"></div>

				<div id="bottombar">
					<a id="commons" href="http://www.creativecommons.org/" title="creative commons"><img src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/CCBYSA.png"></a>
					<div id="copyright">All contents licensed under a Creative Commons Attribution-ShareAlike 4.0 International License.</div>
			</div>

		</div>

		<script type="text/javascript" src="Control%20Tutorials%20for%20MATLAB%20and%20Simulink%20-%20Inverted%20Pendulum%20System%20Modeling_files/script.js"></script>

	




</div></body><grammarly-desktop-integration data-grammarly-shadow-root="true"></grammarly-desktop-integration></html>